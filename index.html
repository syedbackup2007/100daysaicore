<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üî• 100 Day AI</title>

<style>
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,#141e30,#243b55);
  color:white;
}

/* Container */
.container{
  max-width:520px;
  margin:auto;
  padding:15px;
}

/* Top Bar */
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:14px;
  margin-bottom:10px;
}

/* Card */
.card{
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(10px);
  padding:20px;
  border-radius:20px;
  margin-top:15px;
}

input,select,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:12px;
  border:none;
  font-size:15px;
}

button{
  background:#ff416c;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

button:hover{
  opacity:0.9;
}

progress{
  width:100%;
  height:15px;
  margin-top:10px;
}

#welcome{
  text-align:center;
  font-size:22px;
  margin-top:10px;
}

#aiResponse{
  margin-top:15px;
  padding:12px;
  background:rgba(255,255,255,0.05);
  border-radius:12px;
  font-size:14px;
}
</style>
</head>

<body>

<div class="container">

<h2 id="welcome">Welcome</h2>

<!-- SETUP -->
<div id="setup" class="card">
<input id="name" placeholder="Your Name">
<input id="age" type="number" placeholder="Your Age">

<select id="goal">
<option value="weight loss">Weight Loss</option>
<option value="muscle gain">Muscle Gain</option>
<option value="healthy lifestyle">Healthy Lifestyle</option>
<option value="productivity">Productivity</option>
</select>

<select id="personality">
<option value="hardcore">Hardcore üî•</option>
<option value="balanced">Balanced ‚öñÔ∏è</option>
<option value="chill">Chill üåø</option>
</select>

<button onclick="startApp()">Start Challenge</button>
</div>

<!-- APP -->
<div id="app" style="display:none;">

<div class="topbar">
<div id="streak">üî• 0</div>
<div id="xp">XP 0 | Lv 1</div>
</div>

<div class="card">
<h3 id="day">Day 1 / 100</h3>

<progress id="progressBar" max="100" value="1"></progress>

<h3 style="margin-top:15px;">üéØ Daily Task</h3>
<p id="dailyTask">Loading...</p>

<button onclick="completeDay()">Complete Day ‚úÖ</button>
<button onclick="askAI()">Ask AI Coach ü§ñ</button>

<div id="aiResponse"></div>

</div>
</div>

</div>

<script>

function getData(){
  let data=JSON.parse(localStorage.getItem("aiTransform"));

  if(!data){
    data={
      name:"",
      age:"",
      goal:"",
      personality:"",
      day:1,
      streak:0,
      xp:0,
      level:1,
      lastComplete:0
    };
  }

  return data;
}

function saveData(data){
  localStorage.setItem("aiTransform",JSON.stringify(data));
}

function startApp(){

  const nameValue=name.value.trim();
  const ageValue=age.value.trim();

  if(!nameValue || !ageValue){
    alert("Please enter name and age");
    return;
  }

  let data=getData();

  data.name=nameValue;
  data.age=ageValue;
  data.goal=goal.value;
  data.personality=personality.value;

  saveData(data);

  setup.style.display="none";
  app.style.display="block";

  loadApp();
  generateDailyTask();
}

function loadApp(){

  let data=getData();

  welcome.innerText="Welcome " + data.name;

  day.innerText="Day " + data.day + " / 100";
  streak.innerText="üî• " + data.streak;
  xp.innerText="XP " + data.xp + " | Lv " + data.level;

  progressBar.value=data.day;
}

async function generateDailyTask(){

  let data=getData();

  const res=await fetch("/.netlify/functions/ai",{
    method:"POST",
    body:JSON.stringify({
      type:"daily",
      name:data.name,
      age:data.age,
      goal:data.goal,
      personality:data.personality,
      day:data.day
    })
  });

  const result=await res.json();
  dailyTask.innerText=result.reply;
}

function completeDay(){

  let data=getData();
  const now=Date.now();
  const diff=now-data.lastComplete;

  if(diff<86400000){
    alert("Come back tomorrow üî•");
    return;
  }

  if(diff>172800000){
    data.streak=0;
  }

  data.day++;
  data.streak++;
  data.xp+=50;

  if(data.xp>=data.level*200){
    data.level++;
  }

  data.lastComplete=now;

  saveData(data);
  loadApp();
  generateDailyTask();
}

async function askAI(){

  let question=prompt("Ask your AI Coach:");

  if(!question) return;

  let data=getData();

  aiResponse.innerText="Thinking...";

  const res=await fetch("/.netlify/functions/ai",{
    method:"POST",
    body:JSON.stringify({
      type:"assistant",
      question:question,
      goal:data.goal,
      personality:data.personality
    })
  });

  const result=await res.json();

  aiResponse.innerText=result.reply;
}

/* AUTO LOAD IF USER EXISTS */
if(localStorage.getItem("aiTransform")){
  setup.style.display="none";
  app.style.display="block";
  loadApp();
  generateDailyTask();
}

</script>

</body>
</html>
